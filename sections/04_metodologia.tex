% ===================== CAPÍTULO IV (drop-in replacement) =====================
\chapter{METODOLOGÍA Y DESARROLLO DEL PROYECTO}
\label{chap:metodologia}

% --- Nota de cumplimiento (no teoría, solo aplicación) ---
% (Hint EN: "Applied chapter, no theory dump.")

\noindent En el presente proyecto se desarrolló TecnoTime, una aplicación Android diseñada para optimizar la gestión de horarios académicos en la FCyT-UMSS. El desarrollo se estructuró en doce fases iterativas e incrementales, detalladas en el Cuadro~\ref{tab:fases_metodologia}, cada una con objetivos, entregables y criterios de aceptación específicos.

Este capítulo documenta la aplicación práctica de la metodología, las decisiones técnicas adoptadas, los artefactos generados y las evidencias verificables de cada fase.

% ---- Opcional: compact helpers (si tus normas lo permiten) ----
\setlength{\emergencystretch}{2em}
% \renewcommand{\arraystretch}{1.08}
% \setlist[itemize]{itemsep=0.25em, topsep=0.25em}
% \setlist[enumerate]{itemsep=0.35em, topsep=0.25em}
% \captionsetup{font=small,skip=6pt}

\providecommand{\Class}[1]{\textsf{#1}}
\providecommand{\ClassRef}[2]{\textsf{#2}}
\newcommand{\cfile}[1]{\texttt{#1}}
\providecommand{\cclass}[2]{\textsf{#2}}

% ----------------------------------------------------------------------
\section{Metodología adoptada: Kanban iterativo-incremental}

Para el desarrollo de TecnoTime se adoptó la metodología Kanban en su variante iterativo-incremental, ajustada a un desarrollador único. Cada fase constituyó un incremento funcional con criterios de aceptación claros y revisión continua mediante tablero digital. Esta aproximación permitió priorizar funcionalidades según la evidencia de la encuesta aplicada y adaptarse a cambios en los requerimientos durante el desarrollo.

\begin{table}[H]
  \centering\small
  \begin{tabularx}{\linewidth}{@{}p{1.2cm}p{3.9cm}>{\RaggedRight\arraybackslash}X@{}}
    \hline
    Fase & Propósito principal & Entregables y evidencias \\
    \hline
    F0 & Identificar necesidades reales mediante estudio de campo & Instrumento de recolección (Google Forms), muestra de 126 estudiantes, análisis cuantitativo con hallazgos clave (94\% Android, 80\% coordina por WhatsApp, 88\% solicita actualización automática) y derivación de requerimientos funcionales trazables. \\
    F1 & Incorporar horarios oficiales al sistema & Canal de descarga controlada de PDF, normalización a esquema Room y verificación de consistencia por carrera. \\
    F2 & Definir el modelo de dominio & Entidades, reglas y agregados consolidados en la capa \texttt{domain}, acompañados de diagramas de referencia. \\
    F3 & Generar horarios viables & Servicio de generación configurable, heurísticas MRV/LCV y pantallas para configurar y aplicar resultados. \\
    F4 & Priorizar el uso sin conexión & Flujos de sincronización diferida, políticas de frescura y mecanismos de recuperación manual. \\
    F5 & Intercambiar horarios & Contrato JSON (formato de intercambio de datos basado en texto) interoperable, flujo de importación/exportación y asistentes para compartir mediante WhatsApp. \\
    F6 & Refinar la experiencia de usuario & Onboarding (pantallas iniciales de orientación), navegación principal, widget (componente visual que se muestra en la pantalla principal del dispositivo) de acceso rápido y guías contextuales. \\
    F7 & Automatizar recordatorios e IA & Notificaciones programadas, plantillas reutilizables y asistente ``Simón'' con activación voluntaria. \\
    F8 & Exportar resultados & Generadores de reporte en PDF, imagen y Excel con validación de formato. \\
    F9 & Realizar aseguramiento de calidad & Batería de pruebas instrumentadas, casos manuales priorizados y checklist de aceptación. \\
    F10 & Endurecer seguridad y privacidad & Gestión de permisos, cifrado de datos sensibles y revisión de políticas de respaldo. \\
    F11 & Preparar liberación y métricas & Empaquetado en release, tablero de indicadores (TTS, adopción) y plan de seguimiento post despliegue. \\
    \hline
  \end{tabularx}
  \caption[Aplicación de la metodología por fases]{Aplicación de la metodología por fases.}
  \label{tab:fases_metodologia}
  \small{Fuente: Elaboración propia.}
\end{table}

\subsection{Contexto empírico}
El desarrollo partió de un prototipo de ingesta de PDF y normalización local. A partir de esa base se ejecutaron iteraciones sobre selección de materias, generación de horarios y validaciones con usuarios piloto.

Las fases posteriores incorporaron intercambio JSON para envío y recepción de horarios, mejoras de experiencia de usuario (pantallas guía, configuración y widget), recordatorios y exportaciones en formatos comunes. Al cierre se integró la asistencia ``Simón'' como componente optativo y se documentaron controles de seguridad.

\subsection{Factores de decisión}
La encuesta aplicada a 125 estudiantes orientó las prioridades del tablero:
\begin{itemize}
  \item Preferencia por Android (aproximadamente 71,7\%): orientación exclusiva a componentes nativos y widget principal.
  \item Coordinación por WhatsApp (aproximadamente 80,3\%): intercambio de horarios mediante JSON y acciones directas de compartir.
  \item Sincronización automática (aproximadamente 88,4\%): verificación de frescura y actualización discreta sin intervención del usuario.
  \item Uso sin conexión (aproximadamente 77,7\%): arquitectura offline-first (prioriza el funcionamiento sin conexión) con caché local prioritaria.
  \item Recordatorios (aproximadamente 56,2\%): programación de notificaciones con plantillas y canales específicos.
  \item Compartir horario (aproximadamente 51,2\%): exportación a PDF, imagen y Excel con parámetros de periodo.
\end{itemize}

\subsection{Decisiones técnicas derivadas}
Los factores anteriores guiaron la priorización de las fases (ver Cuadro~\ref{tab:fases_metodologia}: F4--F8) y condicionaron los artefactos liberados por incremento. Se reforzó el almacenamiento local y la sincronización diferida. Asimismo, se consolidó el contrato JSON con asistentes de importación y envío, se diseñaron recordatorios parametrizables y se establecieron exportaciones multiplataforma. Los artefactos y evidencias se encuentran documentados en \cite{tecnotime_repo}.

\subsection{Arquitectura de la solución}
La solución se apoya en una aplicación Android autosuficiente: la interacción sucede en la interfaz offline (Jetpack Compose), el motor de dominio coordina reglas y recordatorios, la ingesta procesa PDFs y la persistencia local resguarda horarios, configuraciones y políticas de frescura.

El asistente IA opera sobre el mismo contexto y la única integración externa es el portal UMSS que publica los PDFs oficiales. La Figura \ref{fig:arquitectura_tecnotime} resume esta arquitectura offline-first.

\begin{figure}[H]
  \centering
  \includegraphics[width=1\linewidth]{images/diagrams/cap4_arq_general.png}
  \caption[Arquitectura general empleada en TecnoTime]{Arquitectura general empleada en TecnoTime.}
  \label{fig:arquitectura_tecnotime}
  \small{Fuente: Elaboración propia.}
\end{figure}

% ----------------------------------------------------------------------
\section{Estudio de campo y levantamiento de requerimientos}

Esta sección documenta el proceso completo de investigación empírica realizado para fundamentar el desarrollo de TecnoTime, desde el diseño del instrumento de recolección hasta la derivación de requerimientos funcionales trazables.

\subsection{Diseño del instrumento de recolección}

Para fundamentar el desarrollo de TecnoTime en necesidades reales de los estudiantes de la FCyT, se diseñó un cuestionario estructurado orientado a capturar patrones de uso de herramientas actuales, puntos de dolor en la gestión de horarios y expectativas sobre funcionalidades deseadas en una aplicación móvil complementaria.

El instrumento se organizó en cuatro bloques temáticos: caracterización del encuestado (carrera, semestre, dispositivos utilizados), uso de herramientas actuales (Cappuchino, PDFs oficiales, canales de comunicación), problemática percibida (frustración, repetición de pasos, dificultades de coordinación) y demandas específicas (actualización automática, modo sin conexión, recordatorios, compartir horarios).

El cuestionario fue aplicado mediante Google Forms durante el periodo académico 2025-I, con participación voluntaria y anónima. El instrumento completo se presenta en el Anexo \ref{ann:instrumento}, mientras que los resultados tabulados se encuentran documentados en la subsección \ref{sec:historias_usuario} de este capítulo y en formato digital \cite{encuesta_fcyt_2025}.

\subsection{Aplicación y características de la muestra}

Se aplicó un muestreo por conveniencia dirigido a estudiantes de la Facultad de Ciencias y Tecnología de la UMSS, obteniendo un total de 126 respuestas válidas. La muestra incluyó estudiantes de diferentes carreras, niveles académicos y turnos, reflejando la diversidad de la población objetivo.

El perfil de los encuestados abarca desde estudiantes de primeros semestres hasta niveles avanzados, con predominio de las carreras de Ingeniería Informática e Ingeniería de Sistemas. La participación fue voluntaria y la tasa de respuesta completa alcanzó el 100\% de los formularios iniciados, evidenciando el interés de los estudiantes en la problemática abordada.

\subsection{Resultados cuantitativos de la encuesta}

Los resultados de la encuesta aplicada a 126 estudiantes de la FCyT se presentan organizados por dimensiones temáticas, comenzando por el análisis de dispositivos utilizados y continuando con patrones de uso, coordinación social y demandas específicas.

\begin{enumerate}[label=\textbf{\arabic*.}]
  \item \textbf{Dispositivos utilizados}

  El análisis de dispositivos revela una marcada preferencia por plataformas móviles. El 94\% de los encuestados utiliza dispositivos Android como herramienta principal para consultas académicas, mientras que solo el 26\% dispone de computadora portátil de uso regular. Esta distribución confirma la necesidad de priorizar el desarrollo nativo para Android y optimizar la experiencia móvil.

  \begin{figure}[H]
    \centering
    \includegraphics[width=0.7\textwidth]{images/diagrams/encuesta_dispositivo.png}
    \caption[Distribución de dispositivos utilizados por los estudiantes (n=126)]{Distribución de dispositivos utilizados por los estudiantes (n=126).}
    \label{fig:encuesta_dispositivo}
    \small{Fuente: \cite{encuesta_fcyt_2025}.}
  \end{figure}

  \item \textbf{Uso de Cappuchino}

  La herramienta Cappuchino presenta un patrón de uso concentrado en periodos específicos. El 48\% de los estudiantes la utiliza únicamente durante el periodo de inscripción, mientras que el 44\% la consulta varias veces por semestre. Solo el 8\% reporta un uso diario o muy frecuente, evidenciando que la herramienta no cubre necesidades de consulta continua fuera del periodo de inscripción.

  \begin{figure}[H]
    \centering
    \includegraphics[width=0.7\textwidth]{images/diagrams/encuesta_uso_capuchino.png}
    \caption[Frecuencia de uso de Cappuchino por los estudiantes (n=126)]{Frecuencia de uso de Cappuchino por los estudiantes (n=126).}
    \label{fig:encuesta_uso_capuchino}
    \small{Fuente: \cite{encuesta_fcyt_2025}.}
  \end{figure}

  \item \textbf{Coordinación social mediante WhatsApp}

  El 80\% de los encuestados valida información de horarios y coordina cambios mediante grupos de WhatsApp, confirmando que la mensajería instantánea se ha convertido en un canal informal pero crítico para la gestión de información académica. Este hallazgo fundamenta la necesidad de habilitar intercambio estructurado de horarios compatible con plataformas de mensajería.

  \begin{figure}[H]
    \centering
    \includegraphics[width=0.5\textwidth]{images/diagrams/encuesta_whatsapp.png}
    \caption[Coordinación social mediante WhatsApp (n=126)]{Coordinación social mediante WhatsApp (n=126).}
    \label{fig:encuesta_whatsapp}
    \small{Fuente: \cite{encuesta_fcyt_2025}.}
  \end{figure}

  \item \textbf{Frustración por repetir pasos}

  El 60\% de los estudiantes califica como alta su frustración (niveles 1-2-3 en escala de 1 a 5) por tener que repetir pasos para consultar horarios. Este indicador evidencia la necesidad de memoria de contexto y persistencia de selecciones para evitar procesos repetitivos en cada sesión de consulta.

  \begin{figure}[H]
    \centering
    \includegraphics[width=0.7\textwidth]{images/diagrams/encuesta_frustracion.png}
    \caption[Nivel de frustración por repetir pasos (n=126)]{Nivel de frustración por repetir pasos (n=126).}
    \label{fig:encuesta_frustracion}
    \small{Fuente: \cite{encuesta_fcyt_2025}.}
  \end{figure}

  \item \textbf{Principales demandas identificadas}

  Las demandas con mayor valoración por parte de los estudiantes incluyen: actualización automática de horarios (88\%), modo sin conexión (78\%), recordatorios antes de clase (56\%) y funcionalidad de compartir horarios (51\%). Estas prioridades guiaron la definición de las fases correspondientes del desarrollo (ver Cuadro~\ref{tab:fases_metodologia}: F4, F5, F7 y F8).

  \begin{figure}[H]
    \centering
    \includegraphics[width=0.7\textwidth]{images/diagrams/encuesta_demandas.png}
    \caption[Principales demandas de los estudiantes (n=126)]{Principales demandas de los estudiantes (n=126).}
    \label{fig:encuesta_demandas}
    \small{Fuente: \cite{encuesta_fcyt_2025}.}
  \end{figure}
\end{enumerate}

\subsection{Derivación de requerimientos funcionales}

Los hallazgos cuantitativos de la encuesta se tradujeron en requerimientos funcionales específicos mediante un proceso de trazabilidad que vincula cada demanda identificada con una funcionalidad concreta de la aplicación y un criterio de aceptación verificable.

\begin{table}[H]
  \centering
  \small
  \begin{tabular}{|p{5.0cm}|p{7.5cm}|p{3.5cm}|}
    \hline
    Hallazgo & Requerimiento derivado & Criterio de aceptación \\
    \hline
    94\% usa Android & Priorizar Android y vista móvil & Flujo usable sin laptop \\
    \hline
    60\% frustración por repetir pasos & Memoria de carrera/nivel/materias & Ingreso sin repetir selección \\
    \hline
    80\% coordina por WhatsApp & Intercambio estructurado en JSON & Compartir/abrir desde mensajería \\
    \hline
    78\% valora modo sin conexión & Operación offline-first & Consulta sin red \\
    \hline
    57\% valora notificaciones & Recordatorios previos a clase & Alertas configurables \\
    \hline
    88\% solicita actualización automática & Actualización desde fuente oficial & Fecha visible de actualización \\
    \hline
  \end{tabular}
  \caption[Trazabilidad de hallazgos a requerimientos funcionales]{Trazabilidad de hallazgos a requerimientos funcionales.}
  \label{tab:derivacion_req}
  \small{Fuente: Elaboración propia basada en \cite{encuesta_fcyt_2025}.}
\end{table}

\subsection{Proceso propuesto (TO-BE)}

Con base en las demandas identificadas y los requerimientos derivados, se diseñó un proceso mejorado que aborda las limitaciones del flujo actual. El proceso propuesto con TecnoTime simplifica la gestión de horarios mediante: generación automática de combinaciones sin choques, memoria de contexto para evitar repetición de selecciones, intercambio estructurado compatible con mensajería, consulta diaria sin conexión y recordatorios configurables antes de clase.

\begin{figure}[H]
  \centering
  \includegraphics[width=0.35\textwidth]{images/diagrams/area_tobe_proceso.png}
  \caption[Procesos propuestos (TO-BE) a nivel de uso]{Procesos propuestos (TO-BE) a nivel de uso con TecnoTime.}
  \label{fig:area_tobe}
  \small{Fuente: Elaboración propia.}
\end{figure}

El proceso propuesto reduce significativamente los pasos necesarios para consultar y actualizar horarios, elimina la dispersión de información entre múltiples canales y habilita funcionalidades de coordinación social mediante formatos estructurados.

\subsection{Historias de usuario derivadas}\label{sec:historias_usuario}

A partir de los requerimientos funcionales identificados mediante la encuesta y el análisis del proceso TO-BE, se elaboró un conjunto completo de historias de usuario organizadas por área funcional. Cada historia sigue el formato estándar: \textbf{Como} [rol] \textbf{necesito} [funcionalidad] \textbf{para} [beneficio], acompañada de criterios de aceptación Given-When-Then (G/W/T) y priorización mediante el método MoSCoW (Must/Should/Could/Won't).

Las historias de usuario se agrupan en las siguientes categorías funcionales, reflejando tanto las demandas identificadas en la encuesta como los requisitos técnicos del sistema:

\begin{itemize}[nosep]
  \item Onboarding y configuración inicial de perfil
  \item Gestión de carreras, niveles y seguimiento de progreso académico
  \item Navegación en la pantalla principal, vista semanal y widget
  \item Administración de materias y grupos
  \item Gestión de profesores y favoritos
  \item Generador de horarios con restricciones y optimización
  \item Exportación, importación e intercambio de horarios
  \item Recordatorios automatizados y asistente IA ``Simón''
  \item Operación sin conexión, actualización automática y resiliencia
  \item Soporte, información y preferencias del usuario
  \item Seguridad, privacidad, rendimiento y accesibilidad
\end{itemize}

El conjunto completo comprende 63 historias de usuario (US-01 a US-63), documentadas en formato tabular con identificador único, rol, necesidad, beneficio, criterios de aceptación resumidos y nivel de prioridad. Las tablas completas se presentan a continuación:

\input{sections/metodologia/historias_usuario}

% ----------------------------------------------------------------------
% (Reubicado al final del capítulo para que 4.2 inicie con F1)
% \section{Mapa de fases (F1-F11)} — contenido movido más adelante

% ============================
\section{F1: Ingestión y normalización (de PDF a BD)}

Esta fase constituye el punto de partida del desarrollo, estableciendo el mecanismo de adquisición y transformación de datos oficiales desde archivos PDF publicados por la UMSS hacia un modelo estructurado persistente en la base de datos local de la aplicación.

\subsection{Objetivo}
Transformar horarios oficiales (PDF) a un modelo estructurado local, controlando la carga a la fuente y asegurando la frescura de los datos.

\subsubsection{4.2.1 Verificación de caché y decisión}
Al abrir el generador se valida conectividad y vigencia de datos. Si el contenido local está fresco, se usa cache; de lo contrario, se inicia sincronización automática.
\begin{itemize}
  \item Control en la interfaz: `GenerateScheduleViewModel` ejecuta \textsf{checkConnectivityAndSync()} y bloquea acciones durante sincronización.
  \item Conectividad: `NetworkConnectivityChecker` discrimina entre online/offline.
  \item Frescura: `AutoSyncUseCase` compara \textsf{updatedDate} remoto con \textsf{lastSyncTime} local (por carrera) y decide actualizar.
  \item Preferencias: `SyncPreferences` limita chequeos con una ventana (p. ej., 6 horas) para evitar consultas excesivas.
\end{itemize}

\begin{figure}[H]
  \centering
  \includegraphics[width=0.35\linewidth]{images/diagrams/cap4_c4_1_context.png}
  \caption[C4 Nivel 1 — Contexto del sistema para F1]{C4 Nivel 1 — Contexto del sistema para F1.}
  \label{fig:c4_context_f1}
  \small{Fuente: Elaboración propia.}
\end{figure}

\subsubsection{4.2.2 Ingesta, análisis y persistencia con frescura}
Cuando se requiere actualización, el flujo descarga, extrae y analiza el PDF oficial; luego normaliza y persiste en Room. Se aplican controles de retroceso exponencial (backoff) y cortacircuito (circuit breaker) para proteger la fuente.
\begin{itemize}
  \item Descubrimiento/descarga: `ScheduleScraper` ubica recursos y `PdfDownloader` obtiene el PDF.
  \item Extracción y análisis: `PdfExtractor` obtiene texto; `PdfParser` (componente que analiza y transforma datos de entrada) aplica expresiones regulares tolerantes para cabeceras, grupos, días y horas, consolidando líneas y docentes.
  \item Normalización/persistencia: `ImportCareerSchedulesUseCase` proyecta entidades y persiste con índices únicos compuestos (Room) y políticas \textsf{ON CONFLICT}.
  \item Frescura: tras actualizar, se registra \textsf{lastSyncTime} por carrera y se guarda el instante del chequeo en `SyncPreferences`.
  \item Robustez: `ExponentialBackoff` y `CircuitBreaker` controlan reintentos y abren/cierran el circuito ante fallas repetidas.
  \item Respaldo: si no hay red, se permite importación manual desde PDF local y se opera totalmente en caché.
\end{itemize}

\begin{figure}[H]
  \centering
  \includegraphics[width=1\linewidth]{images/diagrams/cap4_c4_2_container.png}
  \caption[C4 Nivel 2 — Contenedores involucrados en F1]{C4 Nivel 2 — Contenedores involucrados en F1.}
  \label{fig:c4_container_f1}
  \small{Fuente: Elaboración propia.}
\end{figure}

\begin{figure}[H]
  \centering
  \includegraphics[width=1\linewidth]{images/diagrams/cap4_c4_3_component_f1.png}
  \caption[C4 Nivel 3 — Componentes de ingesta y normalización (F1)]{C4 Nivel 3 — Componentes de ingesta y normalización (F1).}
  \label{fig:c4_component_f1}
  \small{Fuente: Elaboración propia.}
\end{figure}

\begin{figure}[H]
  \centering
  \includegraphics[width=1\linewidth]{images/diagrams/cap4_c4_4_code_f1.png}
  \caption[C4 Nivel 4 — Clases y casos de uso relevantes (F1)]{C4 Nivel 4 — Clases y casos de uso relevantes (F1).}
  \label{fig:c4_code_f1}
  \small{Fuente: Elaboración propia.}
\end{figure}

Criterios de entrada (Entry).
Conectividad disponible o PDF local; sin sincronización en curso.

Criterios de salida (Exit/DoD).
Base de datos consistente por carrera, nivel, materia, grupo y bloques; \textsf{lastSyncTime} actualizado; pruebas de ingestión y nuevo análisis exitosas.

Evidencias (código).
\begin{itemize}
  \item Caso de uso de sincronización automática (\Class{AutoSyncUseCase}) y preferencias de sincronización (\Class{SyncPreferences}) para ventanas y sellos de tiempo.
  \item Rastreador de horarios (\Class{ScheduleScraper}) y componentes de adquisición/procesamiento de PDF (\Class{PdfDownloader}/\Class{PdfExtractor}/\Class{PdfParser}).
  \item Importación por carrera (\Class{ImportCareerSchedulesUseCase}) y componentes de resiliencia (\Class{ExponentialBackoff}, \Class{CircuitBreaker}).
\end{itemize}

KPIs.
Cache hit-rate semanal $\geq 80\%$; reintentos acotados; tiempo de ingesta por PDF dentro del objetivo operacional.

% ============================
\section{F2: Modelo de dominio (entidades, reglas, mapeo)}

Esta fase consolida la arquitectura de datos de TecnoTime, definiendo el modelo de dominio que sustenta todas las operaciones de la aplicación y garantiza la integridad referencial entre entidades.

\subsection{Objetivo}
Consolidar un modelo de dominio coherente con el área de aplicación, garantizando integridad y trazabilidad entre entidades y sus reglas.

\subsection{Qué se hizo}
Se modelaron entidades y relaciones clave; se definieron índices/llaves para unicidad e integridad; y se implementaron mapeos entre ingreso (PDF/JSON), dominio y almacenamiento.

\subsection{Entidades (derivadas del código)}
El modelo de dominio de TecnoTime constituye la representación conceptual del problema de gestión de horarios académicos, traducido a entidades de software que encapsulan tanto datos como comportamiento. Este modelo se deriva directamente del análisis del código fuente implementado, garantizando la trazabilidad entre el diseño conceptual y la implementación real. Las entidades principales abarcan desde la representación de materias y grupos hasta la gestión de preferencias de usuario y configuraciones del sistema. A continuación se detallan las entidades fundamentales que componen este modelo:

\begin{itemize}
  \item Materia: \cclass{domain/model/Subject.kt}{Subject} (\textsf{code}, \textsf{name}, \textsf{isElective}, \textsf{isApproved}, \textsf{isActive}).
  \item Grupo: \Class{Group} (\textsf{id}, \textsf{subjectCode}, \textsf{groupId}, \textsf{levelId}, \textsf{groupName}, \textsf{type}, \textsf{modality}, \textsf{isActive}).
  \item Bloque/Slot: \Class{GroupSchedule} (\textsf{day}, \textsf{startTime}, \textsf{endTime}, aula/docente opcionales).
  \item Carrera/Nivel: \Class{Career}, \Class{Level}; agregados: \Class{CareerWithLevels}, \Class{LevelWithSubjects}.
  \item Docente/Aula: \Class{Teacher}, \Class{Classroom}.
  \item Selección del usuario: \Class{SelectedSubject}, \Class{SelectedSubjectWithGroup}.
  \item Preferencias/Usuario: \Class{UserSettings} (24h, fines de semana, recordatorios, IA opt-in, etc.).
\end{itemize}

\subsection{Reglas e invariantes}
La integridad del modelo de dominio se sustenta en un conjunto de reglas e invariantes que garantizan la consistencia de los datos a lo largo del ciclo de vida de la aplicación. Estas reglas abarcan desde restricciones de unicidad en identificadores hasta validaciones temporales que aseguran la coherencia de los horarios. La implementación de estas invariantes se realiza tanto a nivel de base de datos mediante índices y restricciones de integridad referencial, como a nivel de lógica de negocio mediante validaciones en los casos de uso. El cumplimiento estricto de estas reglas previene estados inconsistentes que podrían comprometer la funcionalidad del generador de horarios o la experiencia del usuario. Las reglas establecidas son:

\begin{itemize}
  \item Unicidad de \textsf{Subject.code}: \Class{SubjectEntity} define índice único sobre \textsf{code}.
  \item Unicidad compuesta \textsf{(subjectCode, groupId)}: \Class{GroupEntity} con índice compuesto único; FK a \Class{LevelEntity} y \Class{SubjectEntity}.
  \item Temporal: \Class{GroupScheduleEntity} asegura \textsf{startTime}–\textsf{endTime} para cada \textsf{day} y \textsf{groupId}; validación operativa start<end al normalizar/guardar.
  \item Integridad referencial: FKs en \Class{GroupScheduleEntity} hacia \Class{GroupEntity}, \Class{TeacherEntity} y \Class{ClassroomEntity} (nulables cuando no hay asignación).
\end{itemize}

\subsection{Mapeos del ingreso al dominio y al almacenamiento}
La arquitectura de TecnoTime implementa una clara separación entre las capas de ingreso de datos, dominio y persistencia, requiriendo transformaciones explícitas entre las representaciones de cada capa. Los mapeos bidireccionales permiten convertir datos desde formatos externos como PDF y JSON hacia el modelo de dominio, y posteriormente hacia entidades de base de datos para su almacenamiento persistente. Esta estrategia de mapeo explícito facilita la evolución independiente de cada capa, permite la validación de datos en cada transformación y simplifica las pruebas unitarias al aislar las responsabilidades de cada componente. Los principales componentes de mapeo implementados son:

\begin{itemize}
  \item DTO de horario compartible (\cclass{domain/model/ShareableScheduleDto.kt}{ShareableScheduleDto}) y analizadores PDF/JSON para el ingreso.
  \item Mapeadores de dominio (p. ej., \Class{SubjectMapper}, \Class{GroupMapper}, \Class{GroupScheduleMapper}, \Class{UserSettingsMapper}) para transformar entre entidades y dominio.
  \item Casos de uso para interoperabilidad JSON (\cclass{domain/usecase/GenerateShareableScheduleJsonUseCase.kt}{GenerateShareableScheduleJsonUseCase}, \Class{LoadShareableScheduleUseCase}, \Class{ImportSharedScheduleUseCase}).
\end{itemize}

\subsection{Evidencias (código)}
La implementación del modelo de dominio se materializa en un conjunto de clases Kotlin que reflejan fielmente el diseño conceptual presentado. Estas clases se organizan en el paquete domain/model y siguen los principios de inmutabilidad y encapsulamiento propios de la programación funcional. Las entidades de base de datos correspondientes se definen en el paquete data/local/entity utilizando las anotaciones de Room para especificar índices, relaciones y restricciones. La correspondencia uno a uno entre entidades de dominio y entidades de persistencia facilita el mantenimiento y la comprensión del código. Las clases principales que evidencian este modelo son:

\begin{itemize}
  \item Unicidad: \Class{SubjectEntity}: índice unique(\textsf{code}); \Class{GroupEntity}: índice compuesto unique(\textsf{subject\_code}, \textsf{group\_id}).
  \item Modelos: \Class{Subject}, \Class{Group}, \Class{GroupSchedule}, \Class{UserSettings}.
  \item Mapeo: \Class{GroupMapper} incluye \textsf{levelId}, \textsf{subjectCode} y \textsf{groupId} como claves de relación.
\end{itemize}

Como apoyo visual, la Figura \ref{fig:f2_modelo_dominio_er} ilustra el diagrama entidad–relación del modelo de dominio, destacando entidades operativas, claves e integridad referencial utilizadas en la implementación.

\begin{figure}[H]
  \centering
  \includegraphics[width=1\linewidth]{images/diagram_er.png}
  \caption[Modelo de dominio: diagrama entidad–relación (ER)]{Modelo de dominio: diagrama entidad–relación (ER).}
  \label{fig:f2_modelo_dominio_er}
  \small{Fuente: elaboración propia.}
\end{figure}

\subsection{Criterios de entrada/salida (Entry/Exit/DoD)}
Entrada: entidades y relaciones definidas, migraciones aplicadas y datos de prueba disponibles.

Salida/DoD: unicidad e integridad referencial verificadas; mapeos ida/vuelta probados; repositorios y casos de uso operativos sobre el modelo.

% ============================
\section{F3: Generador (restricciones, heurísticas, UI)}

Esta fase implementa el núcleo algorítmico de TecnoTime, desarrollando el motor de generación automática de horarios que combina restricciones duras, heurísticas de optimización y criterios de preferencia del usuario.

\subsection{Objetivo}
Seleccionar un grupo por materia evitando choques por defecto y optimizando los huecos y la afinidad con docentes favoritos.

\subsection{Qué se hizo}
Se parametrizó el problema, se aplicó búsqueda con poda y heurísticas MRV/LCV con scoring multicriterio y se integró UI para configurar y aplicar resultados.

\subsection{Parámetros reales}
El generador de horarios opera como un sistema configurable que acepta múltiples parámetros para adaptar su comportamiento a las preferencias específicas de cada estudiante. Estos parámetros controlan aspectos críticos como el número máximo de materias a considerar, la cantidad de soluciones alternativas a generar, y las estrategias de optimización a aplicar. La parametrización permite al usuario equilibrar entre la exhaustividad de la búsqueda y el tiempo de ejecución, así como priorizar diferentes criterios de calidad según sus necesidades individuales. Todos los parámetros se encapsulan en la clase ScheduleGenerationParams para garantizar la validación y consistencia de la configuración. Los parámetros configurables son:

\begin{itemize}
  \item Límite de materias por horario: \(\leq\)20 y número de horarios generados: hasta 25. Parametrización en \cclass{domain/model/ScheduleGenerationParams.kt}{ScheduleGenerationParams} (\textsf{totalSubjectsCount}, \textsf{numberOfSchedules}).
  \item Flags principales:
    \begin{itemize}
      \item Priorizar docentes favoritos (\textsf{prioritizeFavoriteTeachers}).
      \item Minimizar huecos (\textsf{minimizeGaps}).
      \item Aceptar choques controlados (\textsf{acceptConflicts}; desactivado por defecto).
      \item Fijar grupos ya elegidos para regeneración parcial (\textsf{fixedGroups}).
    \end{itemize}
\end{itemize}

\subsection{Estrategia operativa}
La generación de horarios viables se aborda como un problema de satisfacción de restricciones (CSP) resuelto mediante búsqueda con retroceso (backtracking) mejorada con heurísticas de poda y ordenamiento. La estrategia operativa combina técnicas clásicas de inteligencia artificial con optimizaciones específicas del dominio académico, como la priorización de niveles inferiores para garantizar la progresión curricular y el manejo especial de series de materias correlativas. El algoritmo construye soluciones incrementalmente, descartando tempranamente las ramas que violan restricciones duras y evaluando las soluciones completas mediante una función de puntuación multicriterio que pondera choques, huecos y preferencias de docentes. Esta aproximación permite generar múltiples alternativas viables en tiempos compatibles con la ejecución en dispositivo móvil. Los componentes estratégicos implementados son:

\begin{itemize}
\item Selección incremental con poda temprana y un orden implícito MRV/LCV; se promueven los niveles bajos mediante \textsf{promoteLowestLevels(...)} y se asegura la progresión de series con \textsf{enforceSeriesProgression(...)} en \texttt{GenerateSchedulesUseCaseImpl}.
\item Priorización de grupos con docentes favoritos mediante \textsf{prioritizeGroupsByFavoriteTeacher(...)}: los favoritos sin conflicto prevalecen y, si \textsf{acceptConflicts} está habilitado, se consideran también los que generan conflicto.
\item Se definió una fábrica de estrategias (\texttt{ScheduleStrategyFactory}), que integra: estrategia de aceptación de choques (\texttt{AcceptConflictsStrategy}, peso 1.0), estrategia para minimizar huecos (\texttt{MinimizeGapsStrategy}, peso 1.0 cuando está activa) y estrategia para priorizar docentes favoritos (\texttt{PrioritizeTeachersStrategy}, peso 2.0 cuando está activa) dentro de un compuesto (\texttt{CompositeStrategy}). Estas ponderaciones priorizan evitar choques (crítico), reducir huecos (confort) y favorecer docentes favoritos (preferencia fuerte cuando se habilita).
\item El generador de horarios (\texttt{ScheduleGenerator}) conserva las mejores combinaciones (Top-N) y penaliza la ausencia de alternativas preferidas.
\end{itemize}
(Rutas completas en el Anexo \ref{ann:trazabilidad-tecnotime}).

\subsection{Interacción de usuario (pantallas reales)}
La interfaz de usuario del generador de horarios se diseñó siguiendo los principios de Material Design 3 y las mejores prácticas de UX móvil, priorizando la claridad en la configuración y la facilidad de comparación entre alternativas generadas. El flujo de interacción se estructura en dos pantallas principales: una de configuración donde el usuario selecciona materias y ajusta parámetros, y otra de resultados donde puede visualizar, comparar y aplicar las soluciones propuestas. La implementación utiliza Jetpack Compose para construir interfaces declarativas y reactivas que responden automáticamente a cambios en el estado del generador. Los componentes de UI implementados son:

\begin{itemize}
  \item Pantalla de configuración (\texttt{GenerateScheduleConfigScreen}) y modelo de vista (\texttt{GenerateScheduleViewModel}) para selección de materias, opciones y lanzamiento de la generación.
  \item Pantalla de resultados (\texttt{GenerateScheduleResultsScreen}) y vista previa (\texttt{SchedulePreview}) para aplicar parcial (solo marcadas vía \textsf{fixedGroups}) o completo (todo el horario propuesto).
\end{itemize}
(Rutas completas en el Anexo \ref{ann:trazabilidad-tecnotime}).

\subsection{Diagramas}
A continuación se presentan dos vistas complementarias del proceso de generación: (i) secuencia extremo a extremo desde la UI hasta el evaluador y (ii) decisiones de poda, scoring y relajación.

\begin{figure}[H]
  \centering
  \includegraphics[width=1\linewidth]{images/diagrams/cap4_f3_secuencia_generacion.png}
\caption[Secuencia de generación de horarios]{Secuencia de generación de horarios.}
  \label{fig:f3_secuencia_generacion}
  \small{Fuente: Elaboración propia.}
\end{figure}

\noindent Para facilitar la lectura, la Figura~\ref{fig:f3_decisiones_generador} se organiza en dos paneles: (I) conformación del conjunto candidato (obligatorias, preferencia por docentes y orden de exploración) y (II) evaluación de combinaciones (penalización de huecos, tratamiento de choques y relajación cuando no hay opciones válidas).

\begin{figure}[H]
  \centering
  \begin{minipage}[t]{0.48\linewidth}
    \centering
    \includegraphics[width=\linewidth]{images/diagrams/cap4_f3_decisiones_generador_part1.png}
  \end{minipage}\hfill
  \begin{minipage}[t]{0.48\linewidth}
    \centering
    \includegraphics[width=\linewidth]{images/diagrams/cap4_f3_decisiones_generador_part2.png}
  \end{minipage}
\caption[Decisiones del generador]{Decisiones del generador.}
  \label{fig:f3_decisiones_generador}
  \small{Fuente: Elaboración propia.}
\end{figure}

\subsection{Criterios de entrada/salida (Entry/Exit/DoD)}
Entrada: datos frescos (si hay red) y selección de materias/grupos fijos.

Salida/DoD: \(N\) horarios sin solapes por defecto; aplicación parcial/completa funcional; casos TC-(TBD) ejecutados.

\subsection{KPIs}
TTS (Time-To-Schedule) \(\leq\) 3 min para \(N{=}10\); regeneración parcial \(\leq\) 1 s por cambio.

% \begin{figure}[H]
%   \centering
%   \includegraphics[width=0.82\linewidth]{TODO}
%   \caption{Decisiones y mantenimiento de Top-N (vista simplificada).}
%   \label{fig:f3_generador}
% \end{figure}

\subsection{Criterios y pesos verificados}
La evaluación combina tres estrategias y dos penalizaciones fijas. Resumen breve:
\begin{itemize}
  \item Choques: \texttt{AcceptConflictsStrategy} (peso 1.0). Siempre activo. Si \textsf{acceptConflicts=false}, un choque descarta la combinación (infinito); si \textsf{true}, aplica penalización baja por conflicto.
  \item Huecos (gaps): \texttt{MinimizeGapsStrategy} (peso 1.0). Activo solo con \textsf{minimizeGaps=true}. Puntúa la suma de recesos entre bloques; menor es mejor.
  \item Docentes favoritos: \texttt{PrioritizeTeachersStrategy} (peso 2.0). Activo con \textsf{prioritizeFavoriteTeachers=true}. Reduce el puntaje cuando hay bloques con docente favorito.
  \item Penalización por preferidos ausentes: +1000.0 por cada código preferido no satisfecho.
  \item Penalización por grupo no favorito: +1500.0 si, existiendo grupos favoritos para una materia, el elegido no es favorito.
\end{itemize}
(Rutas completas en el Anexo \ref{ann:trazabilidad-tecnotime}).

\subsection{Evidencias (código)}
La implementación del generador de horarios se distribuye en múltiples componentes que separan claramente las responsabilidades de generación, evaluación y presentación. El núcleo algorítmico reside en las clases de casos de uso y generadores, mientras que las estrategias de evaluación se implementan como componentes independientes y componibles siguiendo el patrón Strategy. La capa de presentación orquesta la interacción con el usuario y la visualización de resultados mediante ViewModels que exponen el estado como flujos reactivos. Esta arquitectura facilita las pruebas unitarias de cada componente y permite la evolución independiente del algoritmo y la interfaz. Los componentes principales son:

\begin{itemize}
  \item Generación: \Class{GenerateSchedulesUseCaseImpl}, \Class{ScheduleGenerator}.
  \item Estrategias y evaluación: \Class{ScheduleStrategyFactory}, \Class{CompositeStrategy}, \Class{AcceptConflictsStrategy}, \Class{MinimizeGapsStrategy}, \Class{PrioritizeTeachersStrategy}.
  \item UI y orquestación: \Class{GenerateScheduleConfigScreen}, \Class{GenerateScheduleResultsScreen}, \Class{GenerateScheduleViewModel}.
\end{itemize}

% ============================
\section{F4: Prioridad sin conexión (frescura, políticas, fallback)}

Esta fase establece la arquitectura offline-first de la aplicación, priorizando la disponibilidad y consistencia de datos locales mediante políticas de frescura, sincronización controlada y mecanismos de resiliencia.

\subsection{Objetivo}
Asegurar disponibilidad sin red priorizando la caché local, controlando frescura y habilitando recuperación manual por PDF.

\subsection{Qué se hizo}
Se implementaron verificaciones de conectividad y frescura, políticas de sincronización (ventanas/horarios), reintentos con backoff y circuit breaker y alternativa de respaldo (fallback) por PDF local.

\subsection{Frescura}
Antes de invocar el generador se valida conectividad y frescura de datos:
\begin{itemize}
  \item \Class{GenerateScheduleViewModel}: ejecuta \textsf{checkConnectivityAndSync()} al cargar; usa \Class{NetworkConnectivityChecker} y, con red disponible, dispara \Class{AutoSyncUseCase}.
  \item \Class{AutoSyncUseCase}: compara \textsf{Career.updatedDate} remoto con \textsf{lastSyncTime} local y actualiza materias mediante \Class{RefreshSubjectsForCareerUseCase}. Actualiza \textsf{SyncPreferences.setLastSyncCheck()}.
  \item \Class{SyncPreferences}: define intervalo de verificación de 6\,h y evita consultas excesivas.
  \item Durante la sincronización, \Class{GenerateScheduleViewModel} marca \textsf{isSyncing=true} y bloquea generate/regenerate para mantener consistencia.
\end{itemize}

\subsection{Políticas}
\(T_{fresh}=48\,h\): si los datos locales superan ese umbral, se prioriza sincronizar antes de generar. \(W_{nosync}=07{:}00\text{–}12{:}30\) (horario académico): se difieren sincronizaciones automáticas en ese rango para no interrumpir uso intensivo; el ajuste es configurable. Reintentos controlados con:
\begin{itemize}
  \item \Class{ExponentialBackoff}: $t_0{=}2$\,s, $t_{max}{=}1$\,h, multiplicador 2.0 con jitter.
  \item \Class{CircuitBreaker}: umbral de 5 fallos y recuperación en 10\,min; integra \Class{AutoSyncUseCase} para bloquear temporalmente el origen tras errores repetidos.
\end{itemize}

\subsection{Fallback}
Sin conectividad se opera desde caché local (Room). Si el servicio cae pero existe PDF oficial actualizado, se habilita reingesta manual vía \Class{SyncCareerFromLocalPdfUseCase}.

\subsection{Criterios de entrada/salida (Entry/Exit/DoD)}
Entrada: conectividad verificada o disponibilidad de PDF local; sin sincronización en curso.

Salida/DoD: datos locales actualizados y consistentes por carrera; generación bloqueada durante sincronización; reintentos espaciados y circuito recuperado tras fallos.

\subsection{Evidencias (código)}
La arquitectura offline-first de TecnoTime se sustenta en un conjunto de componentes que gestionan la sincronización diferida, el almacenamiento local prioritario y las políticas de frescura de datos. La implementación utiliza WorkManager para programar tareas de sincronización en segundo plano que respetan las restricciones de red y batería del dispositivo, mientras que Room proporciona la capa de persistencia local con soporte para observación reactiva de cambios. Los repositorios implementan el patrón Single Source of Truth, exponiendo siempre los datos locales a la UI y actualizándolos transparentemente cuando la sincronización completa exitosamente. Esta arquitectura garantiza una experiencia de usuario fluida independientemente de la conectividad de red. Los componentes que implementan esta funcionalidad son:

\begin{itemize}
  \item Gate del generador: \Class{GenerateScheduleViewModel} (bandera \textsf{isSyncing}).
  \item Chequeo y sincronización: \Class{NetworkConnectivityChecker}, \Class{AutoSyncUseCase}, \Class{SyncPreferences}.
  \item Fallback manual: \Class{SyncCareerFromLocalPdfUseCase}.
\end{itemize}

\begin{figure}[H]
  \centering
  \includegraphics[width=1\linewidth]{images/diagrams/cap4_f1a_cache_decision.png}
  \caption[Gate de caché y frescura]{Gate de caché y frescura.}
  \label{fig:f4_offline}
  \small{Fuente: Elaboración propia.}
\end{figure}

\begin{figure}[H]
  \centering
  \includegraphics[width=1\linewidth]{images/diagrams/offline_first_sync.png}
  \caption[Sincronización con backoff y circuit breaker]{Sincronización con backoff y circuit breaker.}
  \label{fig:f4_offline_sync}
  \small{Fuente: Elaboración propia.}
\end{figure}

\begin{figure}[H]
  \centering
  \includegraphics[width=1\linewidth]{images/diagrams/cap4_f4_pdf_fallback.png}
  \caption[Fallback por PDF local]{Fallback por PDF local.}
  \label{fig:f4_offline_pdf}
  \small{Fuente: Elaboración propia.}
\end{figure}

% ============================
\section{F5: Interoperabilidad (JSON + WhatsApp)}

Esta fase habilita el intercambio estructurado de horarios entre estudiantes, implementando un contrato JSON interoperable y flujos de exportación/importación compatibles con plataformas de mensajería instantánea.

\subsection{Objetivo}
Permitir compartir e importar horarios entre estudiantes de forma interoperable y segura.

\subsection{Qué se hizo}
Se añadieron exportaciones (PNG/PDF/Excel/JSON), un contrato JSON auto-contenido y flujos de envío/recepción por mensajería con validaciones e importación idempotente.

\subsection{Exportar}
Acciones: imagen (PNG), PDF, Excel y copia JSON del horario. Se solicita confirmación previa; si no hay materias inscritas, se bloquea la exportación con mensaje. Implementación de UI en \texttt{SettingsSendScheduleScreen} y orquestación en \texttt{SettingsSendScheduleViewModel}. Generación: \texttt{GenerateWeeklyScheduleImageUseCase}, \texttt{GenerateWeeklySchedulePdfUseCase}, \texttt{GenerateScheduleExcelUseCase}, \texttt{GenerateShareableScheduleJsonUseCase}. Compartición mediante \textsf{FileProvider} + \textsf{Intent.ACTION\_SEND}. (Rutas completas en el Anexo \ref{ann:trazabilidad-tecnotime}).

\subsection{Enviar copia (JSON)}
Permite selección parcial en \texttt{SettingsSendScheduleViewModel}. El generador JSON \texttt{ShareableScheduleJsonGenerator} produce claves: \textsf{meta}, \textsf{careers}, \textsf{subjects}, \textsf{groups}, \textsf{teachers}, \textsf{classrooms}, \textsf{entries}. (Rutas completas en el Anexo \ref{ann:trazabilidad-tecnotime}).

\subsection{Importar (desde WhatsApp)}
Al abrir el JSON con TecnoTime: \texttt{LoadShareableScheduleUseCase} valida y carga; \texttt{ImportSharedScheduleUseCase} realiza merge sin duplicados y maneja:
\begin{itemize}
  \item Materias ya inscritas/aprobadas (no duplicar; cambio de grupo si aplica).
  \item Diferencia de carrera (\textsf{autoSyncCareers} para sincronizar primero si corresponde).
  \item Persistencia idempotente en \texttt{SelectedSubjectRepository} y \texttt{GroupScheduleRepository}.
\end{itemize}
(Rutas completas en el Anexo \ref{ann:trazabilidad-tecnotime}).

\begin{itemize}[nosep,leftmargin=*]
  \item \texttt{loadEnrolledSubjects()}
  \item \texttt{toggleSubjectSelection()}
  \item \texttt{selectAllSubjects()}
  \item \texttt{clearSelection()}
\end{itemize}

% Rutas omitidas: se referencian por nombre de clase.

\begin{figure}[H]
  \centering
  \includegraphics[width=1\linewidth]{images/diagrams/cap4_f5_share_import_flow_part1.png}
\caption[Exportación del horario en la aplicación]{Exportación del horario en la aplicación.}
  \label{fig:f5_flow_export}
  \small{Fuente: Elaboración propia.}
\end{figure}

\begin{figure}[H]
  \centering
  \includegraphics[width=1\linewidth]{images/diagrams/cap4_f5_share_import_flow_part2.png}
\caption[Importación del horario en la aplicación]{Importación del horario en la aplicación.}
  \label{fig:f5_flow_import}
  \small{Fuente: Elaboración propia.}
\end{figure}

El intercambio define un bloque de metadatos y un cuerpo auto-contenido:
\begin{itemize}
  \item \textsf{meta}: \{\textsf{version}, \textsf{min\_supported}\}. Se usa control semántico (\textsf{1.0.0}). La aplicación acepta archivos cuya \textsf{min\_supported} $\leq$ versión actual del contrato.
  \item \textsf{careers}: carreras implicadas (código y nombre) para habilitar/sincronizar si corresponde.
  \item \textsf{subjects}, \textsf{groups}, \textsf{teachers}, \textsf{classrooms}: catálogos mínimos para enriquecer la vista previa y resolver identificadores.
  \item \textsf{entries}: lista de EnrolledSchedulePreview.
\end{itemize}
Campos mínimos obligatorios por entry para garantizar la importación: \textsf{subject.code}, \textsf{group.groupId} y \textsf{schedule} (día y franja horaria). El resto de atributos enriquecen la experiencia (docente, aula, color/emoji, notificaciones) y se consumen cuando están disponibles.

\subsection{Criterios de entrada/salida (Entry/Exit/DoD)}
Los criterios de entrada y salida definen las condiciones necesarias para iniciar esta fase del desarrollo y las evidencias verificables que demuestran su completitud. Estos criterios garantizan que cada fase se construya sobre una base sólida de trabajo previo y que entregue artefactos de calidad suficiente para las fases subsecuentes. La definición explícita de Definition of Done (DoD) permite evaluar objetivamente el progreso y facilita la toma de decisiones sobre cuándo avanzar a la siguiente fase. Los criterios establecidos son:

\begin{itemize}
  \item Entrada: Materias inscritas disponibles; permisos de almacenamiento/compartir concedidos si aplica; JSON válido al importar.
  \item Salida/DoD: Exportaciones válidas (PNG/PDF/Excel/JSON) compartibles; importación ejecuta validaciones y merge sin duplicados; bloqueos correctos cuando no hay materias.
\end{itemize}

% ============================
\section{F6: UX aplicada: onboarding, navegación, edición y widget}

Esta fase refina la experiencia de usuario mediante flujos guiados, navegación optimizada y componentes de acceso rápido, reduciendo la fricción en tareas frecuentes y mejorando la usabilidad general de la aplicación.

\subsection{Objetivo}
Optimizar la interacción para tareas frecuentes con mínima fricción y consistencia visual.

\subsection{Qué se hizo}
Se diseñaron flujos guiados (onboarding, agregar/editar), navegación por días y un widget informativo; se consolidaron criterios de entrada/salida.

Para mejorar la legibilidad y evitar secuencias con flechas, el Cuadro \ref{tab:f6_resumen_ux} resume los flujos, comportamientos esperados e implementación de componentes de interfaz asociados a F6.

\subsection{Criterios de entrada/salida (Entry/Exit/DoD)}
La siguiente tabla sintetiza los criterios de entrada que deben cumplirse antes de iniciar esta fase, los criterios de salida que marcan su finalización exitosa, y la definición de completitud (DoD) que especifica las condiciones verificables de calidad. Esta estructura tabular facilita la revisión rápida de los requisitos y permite el seguimiento sistemático del avance de la fase. El cuadro presenta:

\begin{table}[H]
   \centering\small
   \begin{tabularx}{\linewidth}{@{}p{3.0cm}>{\RaggedRight\arraybackslash}X>{\RaggedRight\arraybackslash}X@{}}
     \hline
     Flujo & Pasos / Comportamiento & Implementación (clases principales) \\
     \hline
     Onboarding & Bienvenida; nombre de usuario; ajustes iniciales (formato 24h, fines de semana/días sin clase, tema claro/oscuro); sincronización de carreras; progreso por nivel (A, B, C, ... con porcentaje); activación opcional de Simón (IA). & \texttt{WelcomeScreen}, \texttt{WelcomeViewModel}; pantallas de ajustes y componentes comunes según corresponda. \\
     Agregar materia & Secuencia guiada: seleccionar nivel; seleccionar materia; elegir grupo con preview de días/horas; confirmar. Asignación de color/emoji automática con opción de elección manual. & \texttt{AddSubjectFlowScreen}, \texttt{AddSubjectViewModel}; \texttt{SelectLevelScreen}, \texttt{SelectSubjectScreen}, \texttt{SelectGroupScreen}; \texttt{ColorPickerScreen}, \texttt{EmojiPickerScreen}. \\
     Editar grupo & Desde el card del home: cambiar de grupo (con vista de horarios de destino) o finalizar materia con estado aprobado/abandonado (diálogo de confirmación). Edición de color/emoji disponible. & \texttt{EditGroupScreen}, \texttt{EditGroupSelectScreen}, \texttt{EditGroupViewModel}; \texttt{EditColorScreen}, \texttt{EditEmojiScreen}. \\
     Navegación & Deslizamiento entre días; vista semanal con pestañas animadas; selector de fecha en encabezado para ir a una fecha específica. & \texttt{HomeScreen} (paginación), \texttt{WeekDayTabsAnimated}. \\
     Widget & Muestra el día actual; permite desplazamiento entre días; tarjetas con información esencial (materia, grupo, hora, aula, docente). & \texttt{ScheduleAppWidgetProvider}, \texttt{ScheduleRemoteViewsService}; utilidades en \texttt{WidgetDateUtils}, preferencias en \texttt{WidgetPrefs}. \\
     \hline
   \end{tabularx}
   \caption[Resumen de UX aplicada (F6)]{Resumen de UX aplicada (F6).}
  \label{tab:f6_resumen_ux}
  \small{Fuente: Elaboración propia.}
\end{table}

\begin{table}[H]
   \centering\small
   \begin{tabularx}{\linewidth}{@{}p{2.8cm}>{\RaggedRight\arraybackslash}X@{}}
     \hline
     Criterio & Descripción \\
     \hline
     Entrada & Interfaz base disponible con datos mínimos para interacción guiada. \\
     Salida / DoD & Reducción de pasos en tareas críticas; preview consistente; widget operativo y sincronizado. \\
     \hline
   \end{tabularx}
   \caption[Criterios de entrada y salida (F6)]{Criterios de entrada y salida (F6).}
  \label{tab:f6_entry_exit}
  \small{Fuente: Elaboración propia.}
\end{table}

% Rutas omitidas para simplificar; se emplean únicamente nombres de clases.

% ============================
\section{F7: Notificaciones e IA (Simón, opt-in)}

Esta fase incorpora asistencia proactiva mediante recordatorios automatizados y un asistente de inteligencia artificial opcional, manteniendo el principio de activación voluntaria y operación local sin dependencias externas.

\subsection{Objetivo}
Entregar recordatorios puntuales y una IA opcional sin afectar la operación base.

\subsection{Qué se hizo}
Se crearon canales y estilos de notificación, programación en background y un flujo opt-in para IA on-device con control de descarga/uso.

Para estandarizar la presentación y facilitar la lectura, el Cuadro \ref{tab:f7_notif_ai} resume los flujos, el comportamiento esperado y los componentes clave. Se mantiene la activación voluntaria (opt-in) de IA y los canales separados para notificaciones.

\subsection{Criterios de entrada/salida (Entry/Exit/DoD)}
El siguiente cuadro especifica de manera estructurada las precondiciones necesarias para comenzar el trabajo en esta fase, las postcondiciones que indican su finalización, y los criterios de aceptación que definen cuándo los entregables alcanzan el nivel de calidad requerido. Esta documentación explícita de criterios reduce la ambigüedad en la planificación y facilita la coordinación entre diferentes aspectos del desarrollo. La tabla muestra:

\begin{table}[H]
   \centering\small
   \begin{tabularx}{\linewidth}{@{}p{3.5cm}>{\RaggedRight\arraybackslash}X>{\RaggedRight\arraybackslash}X@{}}
     \hline
     Flujo & Comportamiento / Reglas & Implementación (clases principales) \\
     \hline
     Recordatorios de clase y generales & Canales: \textsf{schedule\_channel} (alta prioridad) y \textsf{default}. Anticipación por defecto: 10 minutos (ajustable). Programación en segundo plano con WorkManager. Estilos enriquecidos (imagen, botones, corazón opcional). & \texttt{TecnoTimeApp} (creación de canales); \texttt{NotificationServiceImpl} (mostrar/programar); \texttt{NotifyWorker} (entrega diferida); \texttt{NotificationStyler} (estilos y acciones); \texttt{ShowNotificationUseCase}, \texttt{ScheduleNotificationUseCase}. \\
     IA "Simón" (opt-in, on-device) & Descarga opcional del modelo; evaluación de estado (up-to-date/needs-download); uso con reserva temporal (lease); generación de cierres para check-in y recordatorios cuando está activa. Sin telemetría obligatoria. & \texttt{ModelInitializationService} (estado); \texttt{ModelDownloader} (DownloadManager, metadatos y política Wi‑Fi/datos vía \texttt{UserSettingsRepository}); \texttt{AiModelUsageManager} (uso del modelo); \texttt{AiManagementViewModel} (UI y toggles); \texttt{NotificationActionReceiver} (acciones en notificación y generación de respuestas). \\
     Red y almacenamiento & Selección de red (Wi‑Fi/datos) para descarga; validación de espacio libre; reintentos controlados. IA desactivada por defecto (\textsf{enableAi=false}); opt-out disponible (borrado del modelo). & \texttt{AiManagementViewModel} (flujos de descarga/actualización/borrado); \texttt{UserSettingsRepository} (preferencias). \\
     \hline
   \end{tabularx}
   \caption[Resumen de notificaciones e IA (F7)]{Resumen de notificaciones e IA (F7).}
  \label{tab:f7_notif_ai}
  \small{Fuente: Elaboración propia.}
\end{table}

\begin{figure}[H]
  \centering
  \includegraphics[width=1\linewidth]{images/diagrams/cap4_f7_secuencia_ia_recordatorios_part1.png}
  \caption[Secuencia (1/2): activación y programación del recordatorio]{Secuencia (1/2): activación y programación del recordatorio.}
  \label{fig:f7_notifications_ai_part1}
  \small{Fuente: Elaboración propia.}
\end{figure}

\begin{figure}[H]
  \centering
  \includegraphics[width=1\linewidth]{images/diagrams/cap4_f7_secuencia_ia_recordatorios_part2.png}
  \caption[Secuencia (2/2): reprogramación y respuestas en notificación (Simón/Like)]{Secuencia (2/2): reprogramación y respuestas en notificación (Simón/Like).}
  \label{fig:f7_notifications_ai_part2}
  \small{Fuente: Elaboración propia.}
\end{figure}

\begin{table}[H]
   \centering\small
   \begin{tabularx}{\linewidth}{@{}p{3.0cm}>{\RaggedRight\arraybackslash}X@{}}
     \hline
     Criterio & Descripción \\
     \hline
     Entrada & Permisos de notificación habilitados; IA desactivada salvo activación explícita; canales creados en inicialización. \\
     Salida / DoD & Notificaciones puntuales y configurables; estilos consistentes; IA descargable y reversible (opt-out), integrada a recordatorios y mensajes motivacionales sin afectar el funcionamiento base. \\
     \hline
   \end{tabularx}
   \caption[Criterios de entrada y salida (F7)]{Criterios de entrada y salida (F7).}
  \label{tab:f7_entry_exit}
  \small{Fuente: Elaboración propia.}
\end{table}

% ============================
\section{F8: Export (imagen, PDF, Excel)}

Esta fase amplía las capacidades de portabilidad de TecnoTime, implementando generadores de exportación en formatos estándar que facilitan el archivo, impresión y compartición de horarios en contextos diversos.

\subsection{Objetivo}
Facilitar la portabilidad del horario en formatos estándar y su compartición segura.

\subsection{Qué se hizo}
Se implementaron generadores de imagen, PDF y Excel; y la copia JSON interoperable, con validaciones y share sheet del sistema.

Para mantener consistencia con F6–F7, el Cuadro \ref{tab:f8_export} estructura formatos, reglas de exportación y clases implicadas. Se usa la hoja de compartir del sistema y FileProvider para exponer archivos.

\subsection{Criterios de entrada/salida (Entry/Exit/DoD)}
La tabla a continuación documenta los requisitos previos que habilitan el inicio de esta fase, los resultados esperados que señalan su conclusión, y las métricas de calidad que validan la completitud del trabajo realizado. La especificación clara de estos criterios permite identificar tempranamente bloqueos o dependencias incumplidas y asegura que cada fase agregue valor verificable al producto. El cuadro detalla:

\begin{table}[H]
   \centering\small
   \begin{tabularx}{\linewidth}{@{}p{3.0cm}>{\RaggedRight\arraybackslash}X>{\RaggedRight\arraybackslash}X@{}}
     \hline
     Formato & Reglas / Flujo & Implementación (clases principales) \\
     \hline
     Imagen (PNG) & Confirmación previa; bloqueo si no hay materias inscritas; generación de imagen semanal; comparte vía share sheet con MIME \textsf{image/png}. & \texttt{SettingsSendScheduleScreen} (UI/confirmación/share); \texttt{SettingsSendScheduleViewModel} (orquestación); \texttt{GenerateWeeklyScheduleImageUseCase}. \\
     PDF & Confirmación previa; bloqueo sin materias; generación de PDF semanal; comparte con MIME \textsf{application/pdf}. & \texttt{SettingsSendScheduleScreen}; \texttt{SettingsSendScheduleViewModel}; \texttt{GenerateWeeklySchedulePdfUseCase}. \\
     Excel & Confirmación previa; bloqueo sin materias; generación de hoja con tabla; comparte con MIME \textsf{application/vnd.ms-excel}. & \texttt{SettingsSendScheduleScreen}; \texttt{SettingsSendScheduleViewModel}; \texttt{GenerateScheduleExcelUseCase}. \\
     Copia (JSON) & Selección opcional de materias a incluir; confirmación; comparte con MIME \textsf{application/json}. Detalle del contrato en F5 (interoperabilidad). & \texttt{SettingsSendScheduleScreen} (diálogo de selección); \texttt{SettingsSendScheduleViewModel}; \texttt{GenerateShareableScheduleJsonUseCase} (ver F5). \\
     \hline
   \end{tabularx}
   \caption[Resumen de exportación (F8)]{Resumen de exportación (F8).}
  \label{tab:f8_export}
  \small{Fuente: Elaboración propia.}
\end{table}

\begin{table}[H]
  \centering\small
  \begin{tabularx}{\linewidth}{@{}p{3.2cm}>{\RaggedRight\arraybackslash}X@{}}
    \hline
    Elemento & Descripción \\
    \hline
    Permisos & En Android < 13, se solicita almacenamiento para escritura si aplica; en versiones recientes se comparte vía URI con permisos de lectura temporales. \\
    Share sheet & Se utiliza \textsf{Intent.ACTION\_SEND} con tipo MIME acorde al archivo y bandera \textsf{FLAG\_GRANT\_READ\_URI\_PERMISSION}. \\
    Exposición de archivos & \textsf{FileProvider} otorga URI seguras para archivos generados. \\
    Validaciones previas & Si no existen materias inscritas, no se permite exportar; se informa al usuario. \\
    \hline
  \end{tabularx}
  \caption[Aspectos técnicos de compartición]{Aspectos técnicos de compartición.}
  \label{tab:f8_tecnico}
  \small{Fuente: Elaboración propia.}
\end{table}

\begin{figure}[H]
  \centering
  \includegraphics[width=1\linewidth]{images/diagrams/cap4_f8_export_flow_part1.png}
  \caption[Flujo (1/2): validación, selección de formato y preparación]{Flujo (1/2): validación, selección de formato y preparación.}
  \label{fig:f8_export_flow_part1}
  \small{Fuente: Elaboración propia.}
\end{figure}

\begin{figure}[H]
  \centering
  \includegraphics[width=0.45\linewidth]{images/diagrams/cap4_f8_export_flow_part2.png}
  \caption[Flujo (2/2): confirmación, guardado y compartición]{Flujo (2/2): confirmación, guardado y compartición (FileProvider + share sheet).}
  \label{fig:f8_export_flow_part2}
  \small{Fuente: Elaboración propia.}
\end{figure}

\begin{table}[H]
  \centering\small
  \begin{tabularx}{\linewidth}{@{}p{2.8cm}>{\RaggedRight\arraybackslash}X@{}}
    \hline
    Criterio & Descripción \\
    \hline
    Entry & Materias inscritas presentes; permisos concedidos cuando corresponda; espacio de almacenamiento suficiente. \\
    Exit / DoD & Archivos contienen materia, grupo, día, hora, aula y docente; MIME correcto; compartición exitosa; bloqueo adecuado ante horario vacío. \\
    \hline
  \end{tabularx}
  \caption[Criterios de entrada y salida (F8)]{Criterios de entrada y salida (F8).}
  \label{tab:f8_entry_exit}
  \small{Fuente: Elaboración propia.}
\end{table}

% ============================
\section{F9: Pruebas y validación (QA)}

Esta fase establece el marco de aseguramiento de calidad del proyecto, definiendo la estrategia de pruebas, implementando casos críticos de validación y verificando el cumplimiento de requisitos funcionales y no funcionales.

\subsection{Objetivo}
Verificar funcionalidad crítica end-to-end y asegurar calidad en unidades, integración y UI.

\subsection{Qué se hizo}
Se definió una pirámide de pruebas y se implementaron casos críticos E2E; se validaron parsers, repositorios, generador y flujos de export/import y notificaciones.

\subsection{Criterios de entrada/salida (Entry/Exit/DoD)}
Esta fase establece criterios específicos de entrada, salida y completitud que reflejan sus objetivos particulares y su posición en el flujo de desarrollo. Los criterios de entrada aseguran que se cuenta con los insumos necesarios, los de salida verifican que se produjeron los artefactos esperados, y el DoD confirma que estos artefactos cumplen los estándares de calidad establecidos. Los criterios son:

\begin{itemize}
  \item Entrada: módulos críticos identificados, datos semilla y fixtures disponibles, entorno de pruebas configurado.
  \item Salida/DoD: cobertura \(\geq 75\%\) en módulos núcleo; flujos E2E críticos en verde; issues bloqueantes cerrados.
\end{itemize}

\subsection{Pirámide de pruebas}
Se aplicó el enfoque unit/integration/UI:E2E, alineado al código real:
  \begin{itemize}
    \item Unitarias: utilitarios de tiempo y solapes (\texttt{Utils}), parsers PDF y mapeos (\textsf{data/remote/pdf/*}, \textsf{data/mapper/*}), heurísticas y strategy del generador (\textsf{domain/service/*}).
    \item Integración: repositorios + Room (DAO/Entities) con casos de uso (ingesta/sync, generación, export/import): \textsf{domain/repository/*}, \textsf{data/repository/*}, \textsf{domain/usecase/*}.
    \item UI/E2E: flujos críticos desde onboarding hasta generar, aplicar y exportar/importar, incluyendo widget y recordatorios.
  \end{itemize}
  (Rutas completas en el Anexo \ref{ann:trazabilidad-tecnotime}).

Cobertura objetivo. $\geq 75\%$ en módulos core (generator, parsing, sync, interop) y 100\% de flujos E2E críticos (listados abajo).

\subsection{Casos críticos de validación (E2E y funcionales)}
La validación del generador de horarios requiere un conjunto exhaustivo de casos de prueba que verifiquen tanto el cumplimiento de restricciones duras como la calidad de las soluciones propuestas. Estos casos críticos cubren escenarios extremos como materias con disponibilidad limitada, configuraciones que priorizan diferentes criterios, y situaciones de conflicto entre restricciones. Cada caso de prueba especifica las entradas exactas, los pasos de ejecución y los resultados esperados, permitiendo la verificación automatizada y la detección temprana de regresiones. Los casos implementados son:

\begin{itemize}
  \item TC-ONB-001: Onboarding completo. Entradas/Pasos: Abrir la aplicación, luego ir a Welcome, ingresar el nombre, ajustar el formato 24h, fines de semana y tema, sincronizar carreras, activar IA (opcional), continuar a Home. Resultado esperado: Preferencias persistidas; carreras visibles; IA permanece desactivada si no se activó. Evidencia: \texttt{WelcomeScreen}, \texttt{WelcomeViewModel}; captura [Pendiente].

  \item TC-ADD-002: Agregar materia con cambio de grupo. Entradas/Pasos: Seleccionar nivel, materia, grupo A (preview), confirmar, re-editar y cambiar a grupo B, confirmar. Resultado esperado: Selección final en grupo B; horarios asociados actualizados. Evidencia: \texttt{EditGroupScreen}; captura [Pendiente].

  \item TC-END-003: Finalizar materia (aprobado/abandonar). Entradas/Pasos: En Home, abrir card de materia, finalizar, elegir "Aprobado" y confirmar; repetir con otra en "Abandonar". Resultado esperado: Estado actualizado; materia aprobada no ofertada en generador; abandonar libera cupo. Evidencia: \texttt{EditGroupViewModel}; captura [Pendiente].

  \item TC-GEN-004: Generar sin choques (por defecto). Entradas/Pasos: En Generar: elegir 6 materias, \code{acceptConflicts=false}. Resultado esperado: 1-N horarios sin solapes; mensaje claro si no hay solución. Evidencia: \texttt{GenerateSchedulesUseCaseImpl}, \texttt{ScheduleGenerator}.

  \item TC-GEN-005: Priorizar profesores ON + choques OFF. Entradas/Pasos: Activar \code{prioritizeFavoriteTeachers=true}, \code{acceptConflicts=false}. Resultado esperado: Excluir combinaciones con choque; priorizar grupos con docentes favoritos. Evidencia: \texttt{ScheduleStrategyFactory}, \code{prioritizeGroupsByFavoriteTeacher(...)}.

  \item TC-GEN-006: Priorizar profesores ON + choques ON. Entradas/Pasos: Activar ambos: favoritos y aceptar choques. Resultado esperado: Permitir combinaciones con choque; ranking favorece favoritos; se etiqueta conflicto. Evidencia: \texttt{AcceptConflictsStrategy}, \texttt{PrioritizeTeachersStrategy}.

  \item TC-GEN-007: Obligatorias > límite. Entradas/Pasos: Marcar 8 obligatorias con \code{totalSubjectsCount=6}. Resultado esperado: Excedente pasa a opcional; se optimiza combinación final. Evidencia: \texttt{GenerateSchedulesUseCaseImpl} — \code{promoteLowestLevels(...)}.

  \item TC-EXP-008: Export imagen/PDF/Excel. Entradas/Pasos: Ejecutar export en Settings, confirmar. Resultado esperado: Archivo válido; share sheet abre con MIME correcto; bloqueo si horario vacío. Evidencia: \texttt{SettingsSendScheduleScreen}; \texttt{GenerateWeeklyScheduleImageUseCase}, \texttt{GenerateWeeklySchedulePdfUseCase}, \texttt{GenerateScheduleExcelUseCase}.

  \item TC-JSON-009: Enviar copia JSON (parcial). Entradas/Pasos: Seleccionar parcialmente las materias, exportar JSON, compartir por WhatsApp. Resultado esperado: JSON con claves esperadas; sólo materias seleccionadas; app de destino recibe. Evidencia: \texttt{GenerateShareableScheduleJsonUseCase}, \texttt{ShareableScheduleJsonGenerator}.

  \item TC-JSON-010: Importar JSON (no duplicar / otra carrera). Entradas/Pasos: Abrir JSON en TecnoTime, validar si ya inscritas, si carrera distinta, sincronizar. Resultado esperado: No duplicar inscritas/aprobadas; sugerir sync si carrera difiere; merge sin duplicados. Evidencia: \texttt{LoadShareableScheduleUseCase}, \texttt{ImportSharedScheduleUseCase}.

  \item TC-NOT-011: Recordatorios (10 min; canales). Entradas/Pasos: Habilitar clases, establecer 10 min, programar notificación. Resultado esperado: Notificación en canal correcto y anticipación solicitada; respeta desactivación. Evidencia: \texttt{TecnoTimeApp}, \texttt{NotificationServiceImpl}, \texttt{NotifyWorker}.

  \item TC-OFF-012: Offline con fallback PDF. Entradas/Pasos: Desconectar internet, generar, sincronizar por PDF local oficial. Resultado esperado: App opera con cache; si se provee PDF actual, re-ingesta manual exitosa. Evidencia: \texttt{SyncCareerFromLocalPdfUseCase}.
\end{itemize}
(Rutas completas en el Anexo \ref{ann:trazabilidad-tecnotime}).

% ============================
\section{F10: Seguridad y privacidad}

Esta fase endurece los controles de seguridad y privacidad de la aplicación, implementando gestión de permisos, cifrado de datos sensibles y políticas de respaldo que protegen la información del usuario.

\subsection{Objetivo}
Minimizar datos y permisos y mantener el procesamiento local con controles explícitos.

\subsection{Qué se hizo}
Se restringieron datos/persistencia a lo esencial, se limitaron permisos a casos de uso y se habilitó IA en el dispositivo con activación voluntaria, sin telemetría obligatoria.

\subsection{Criterios de entrada/salida (Entry/Exit/DoD)}
Los criterios definidos para esta fase reflejan su naturaleza específica y sus interdependencias con otras fases del desarrollo. La entrada requiere la disponibilidad de componentes previos en estado funcional, mientras que la salida exige la entrega de artefactos verificados y documentados. El DoD incorpora tanto verificaciones funcionales como no funcionales, asegurando que la fase no solo cumple sus objetivos inmediatos sino que también mantiene la calidad general del sistema. Los criterios son:

\begin{itemize}
  \item Entrada: definición de datos mínimos y permisos requeridos por caso de uso.
  \item Salida/DoD: aplicación operativa con permisos mínimos; datos personales procesados localmente; IA 100\% opt-in/opt-out; sin telemetría obligatoria.
\end{itemize}
Datos mínimos (local). Sólo nombre de usuario y preferencias necesarias (24h, fines de semana, tema, notificaciones, IA). No se recolecta telemetría obligatoria ni se envían datos personales a terceros. Persistencia: Room/SharedPreferences locales (ver \Class{UserSettings}).

Permisos mínimos. \textsf{POST\_NOTIFICATIONS} (Android 13+) para recordatorios; permisos de almacenamiento/compartir sólo cuando export/import lo requiere (vía \textsf{FileProvider} e \textsf{Intent.ACTION\_SEND}). Declaración en el AndroidManifest.

IA on-device (opt-in). Descarga/uso del modelo bajo control del usuario: activar/desactivar IA, elegir medio de descarga (Wi‑Fi/datos), borrar el modelo. Sin telemetría obligatoria; procesamiento local.

% ============================
\section{F11: Release (parámetros y tamaños)}

Esta fase prepara el empaquetado final de la aplicación para distribución, estableciendo configuraciones de release, métricas de seguimiento y procedimientos de despliegue que aseguran la calidad del producto liberado.

\subsection{Objetivo}
Empaquetar y distribuir con tamaños razonables y control de calidad.

\subsection{Qué se hizo}
Se ajustaron parámetros de build, se aplicó shrink/minify en release y se estableció checklist de publicación y métricas.
Parámetros de build. Observados en \code{app/build.gradle.kts}: \code{minSdk=24}, \code{compileSdk=35}, \code{targetSdk=35}. Tipos de build: \code{release} con minify+shrink activos; \code{debug} sin shrink.

Tamaños objetivo. APK $<30$\,MB (sin IA). Modelo IA por defecto \(\sim\)229\,MB (cuantizado Q4\_K\_M; ver \textsf{ModelInitializationService.getDefaultModel()} y \textsf{sizeBytes}). Descarga opcional, fuera del APK.

Distribución. Canales internos/privados para QA y distribución (sin Play Store si así se define). Firma y notas de versión por cada entrega.

Disponibilidad y acceso. La aplicación estará publicada en Google Play el 25 de noviembre de 2025. Hasta esa fecha, se ofrece mediante el programa de pruebas de Google Play; el acceso requiere unirse como tester al grupo correspondiente. Enlace de acceso al programa de pruebas: \url{https://play.google.com/apps/testing/com.fragmind.tecnotime}.
\section{Resumen operacional por fases (F1–F11)}
Esta sección consolida la información operativa de cada fase del desarrollo, presentando de forma sintética los artefactos generados, las decisiones técnicas adoptadas y los criterios de aceptación verificados en cada incremento.

% Resumen compacto de cada fase con artefactos, decisiones y criterios de aceptación.
% Facilita la revisión rápida de todo el desarrollo sin repetir detalles ya documentados.

% ============================


\subsection{F1: Ingesta de PDF a BD}
\begin{itemize}
  \item Objetivo (Goal): Transformar horarios oficiales (PDF) a datos locales sin saturar la fuente.
  \item Qué se hizo: Descubrimiento de URLs, descarga con rate limit, parsing tolerante, normalización, persistencia y marcas de freshness.
  \item Entradas a salidas: Del Remoto (PDF/Scraper) al Local (Room: materias, grupos, bloques).
  \item DoD: BD consistente por carrera/nivel/materia/grupo, last\_sync actualizado, reintentos acotados.
  \item Riesgo clave: Cambios de formato/ubicación del PDF, mitigado con parser flexible y fallback por PDF local.
\end{itemize}

\subsection{F2: Modelo de dominio}
La Fase 2 define el modelo de dominio que representa conceptualmente el problema de gestión de horarios académicos y establece las reglas de integridad que gobiernan las relaciones entre entidades. Este modelo sirve como contrato entre las diferentes capas de la aplicación y como fuente de verdad para la lógica de negocio. La claridad y completitud del modelo de dominio facilita la comunicación entre desarrolladores, simplifica el mantenimiento del código y reduce la probabilidad de inconsistencias en los datos. Los elementos principales son:

\begin{itemize}
  \item Objetivo: Entidades, relaciones y mapeos consistentes para soporte de generador y export.
  \item Qué se hizo: Definición de entidades (Subject, Group, GroupSchedule, Teacher, Classroom, Settings), índices/keys y mappers.
  \item Entradas a salidas: Del Modelo (dominio) al Local (entities) y a UseCases (servicios).
  \item DoD: Unicidad en códigos; integridad referencial; mapeos ida/vuelta probados.
  \item Riesgo: Desalineación dominio/BD $\rightarrow$ mitigado con pruebas de carga y revisión cruzada.
\end{itemize}

\subsection{F3: Generador de horarios}
La Fase 3 implementa el núcleo algorítmico de TecnoTime: el generador de horarios optimizados que resuelve el problema de satisfacción de restricciones mediante búsqueda con retroceso y heurísticas de poda. Esta fase representa el mayor desafío técnico del proyecto, requiriendo el balance entre exhaustividad de la búsqueda, tiempo de ejecución y calidad de las soluciones. El generador debe producir múltiples alternativas viables en tiempos compatibles con la ejecución en dispositivo móvil, considerando restricciones duras como no solapamiento y restricciones blandas como minimización de huecos. Los aspectos clave son:

\begin{itemize}
  \item Objetivo: Producir Top-$N$ horarios sin choques por defecto, optimizando huecos y favoritos.
  \item Qué se hizo: Backtracking con MRV/LCV, poda temprana, composite scoring (choques/gaps/favoritos), aplicación parcial/completa.
  \item Entradas a salidas: De UseCases (Generate/Apply) a UI (configuración y resultados).
  \item DoD: $N$ candidatos válidos; flags influyen en ranking; aplicar parcial/total actualiza selección.
  \item Riesgo: Explosión combinatoria, mitigada con poda y priorización por nivel.
\end{itemize}

\subsection{F4: Prioridad sin conexión (offline-first)}
La Fase 4 establece la arquitectura offline-first que prioriza el almacenamiento local y garantiza la funcionalidad de la aplicación independientemente de la conectividad de red. Esta decisión arquitectónica responde directamente a las necesidades identificadas en la encuesta, donde el 78% de estudiantes valoró el funcionamiento sin conexión. La implementación incluye políticas de frescura de datos, sincronización diferida en segundo plano y mecanismos de recuperación ante fallos de red. Los componentes clave son:

\begin{itemize}
  \item Objetivo: Operación robusta con conectividad intermitente y protección de la fuente.
  \item Qué se hizo: Cache local, freshness gate previo al generador, backoff+circuit breaker, ventana de no-sync, fallback por PDF local.
  \item Entradas a salidas: Del Local (cache) y UseCases (AutoSync) a datos frescos cuando hay red.
  \item DoD: App funcional sin internet; bloqueo de generación durante sync; reintentos espaciados.
  \item Riesgo: Saturar origen, mitigado con CB y ventanas controladas.
\end{itemize}

\subsection{F5 — Interoperabilidad (JSON + WhatsApp)}
La Fase 5 habilita la interoperabilidad entre instancias de TecnoTime mediante un contrato JSON estandarizado que permite compartir horarios a través de canales de mensajería como WhatsApp. Esta funcionalidad responde a la necesidad de coordinación social identificada en la encuesta, donde el 80% de estudiantes utiliza WhatsApp para validar cambios en horarios. El diseño del formato de intercambio balancea completitud de información, compacidad del mensaje y facilidad de validación. Los elementos son:

\begin{itemize}
  \item Objetivo: Compartir e importar horarios de forma confiable entre usuarios.
  \item Qué se hizo: Export JSON total/parcial con versión; import con validación (duplicados, carrera distinta) y merge idempotente.
  \item Entradas a salidas: De UseCases (Share/Import) a UI (enviar/abrir) y Local (fusión).
  \item DoD: JSON válido; import no duplica; sugiere sincronizar carrera distinta antes de fusionar.
  \item Riesgo: Deriva de esquema: mitigado con versionado y validaciones.
\end{itemize}

\subsection{F6 — UX aplicada}
La Fase 6 refina la experiencia de usuario mediante la implementación de patrones de UX móvil que facilitan la adopción y el uso cotidiano de la aplicación. Esta fase incluye el diseño del flujo de onboarding que guía a nuevos usuarios a través de la configuración inicial, la implementación del widget de pantalla principal que proporciona acceso inmediato al horario actual, y la optimización de la navegación para minimizar el número de toques necesarios para completar tareas comunes. El diseño de UX se validó mediante pruebas con usuarios piloto que identificaron puntos de fricción y oportunidades de mejora. Los aspectos principales son:

\begin{itemize}
  \item Objetivo: Reducir fricción: onboarding, ajustes, agregar/editar, vista semanal, widget.
  \item Qué se hizo: Flujos guiados, preview de grupo, selección por nivel/materia, valores por defecto sensatos, widget de acceso rápido.
  \item Entradas$\rightarrow$Salidas: UI (welcome, settings, home, add/edit, weekly) + Widget.
  \item DoD: Menos pasos para armar horario; preview consistente; widget sincronizado.
  \item Riesgo: Sobrecarga de opciones: mitigada con progressive disclosure.
\end{itemize}

\subsection{F7 — Notificaciones e IA (opt-in)}
La Fase 7 integra dos funcionalidades opcionales que enriquecen la experiencia del usuario sin comprometer la simplicidad de la aplicación base: el sistema de notificaciones programables para recordatorios de clases y el asistente de inteligencia artificial "Simón" que opera completamente en el dispositivo. Ambas funcionalidades siguen un modelo opt-in donde el usuario debe activarlas explícitamente, respetando principios de privacidad y control del usuario. El asistente IA utiliza modelos cuantizados en formato GGUF que permiten la inferencia local sin envío de datos a servidores externos, alineándose con los requisitos de privacidad del proyecto. Los componentes son:

\begin{itemize}
  \item Objetivo: Recordatorios puntuales y mensajería opcional con IA on-device.
  \item Qué se hizo: Canales separados (clases/mensajes), WorkManager, plantillas; gestión del modelo IA (descarga/borrado; Wi-Fi/datos; sin telemetría).
  \item Entradas a salidas: De Notif (canales+workers) e IA (local) a avisos y textos opcionales.
  \item DoD: Notifs antes de clase (10 min por defecto) y configurables; IA desactivada por defecto, activable y reversible.
  \item Riesgo: Tamaño de modelo/almacenamiento: mitigado con descarga bajo demanda y opción de eliminar.
\end{itemize}

\subsection{F8 — Exportaciones}
La Fase 8 implementa las capacidades de exportación de horarios en múltiples formatos (PDF, imagen, Excel) que facilitan la distribución y el uso de los horarios fuera de la aplicación. Esta funcionalidad responde a la necesidad identificada en la encuesta donde el 51% de estudiantes solicitó capacidades de compartir horarios. La generación de cada formato requiere transformaciones específicas: el PDF utiliza bibliotecas de renderizado vectorial, la imagen captura la vista de Compose como bitmap, y el Excel estructura los datos en hojas de cálculo con formato condicional. La implementación garantiza que los horarios exportados sean legibles, completos y mantengan la información de contexto necesaria. Los elementos son:

\begin{itemize}
  \item Objetivo: Compartir horario como imagen, PDF o Excel.
  \item Qué se hizo: Confirmación previa, bloqueo si horario vacío, generación por formato y share sheet.
  \item Entradas a salidas: De UseCases (Image/PDF/Excel) a UI (enviar/guardar).
  \item DoD: Archivos contienen materia, grupo, día, hora, aula, docente; MIME correcto; bloqueo sin materias.
  \item Riesgo: Permisos/espacio: mitigado con FileProvider y validaciones previas.
\end{itemize}

\subsection{F9 — Pruebas y validación}
La Fase 9 establece el aseguramiento de calidad mediante una batería de pruebas que validan tanto la funcionalidad individual de componentes como los flujos de extremo a extremo que atraviesan múltiples capas de la aplicación. Las pruebas unitarias verifican la lógica de negocio aislada, las pruebas de integración validan la interacción entre repositorios y casos de uso, y las pruebas de UI confirman que los flujos críticos funcionan correctamente desde la perspectiva del usuario. La cobertura de pruebas se enfoca en los módulos de mayor riesgo: el generador de horarios, los parsers de PDF, y la lógica de sincronización offline. La estructura de pruebas es:

\begin{itemize}
  \item Objetivo: Asegurar calidad funcional y de flujo extremo a extremo.
  \item Qué se hizo: Unitarias (tiempo/solapes/parsers/estrategias), integración (repos+usecases), UI/E2E (onboarding hasta generar, aplicar y exportar/importar).
  \item Entradas a salidas: De Tests (TCs) a reporte de verificación y issues cerrados.
  \item DoD: $\geq 75\%$ cobertura en módulos núcleo; E2E críticos verdes.
  \item Riesgo: Falsos positivos E2E, mitigado con datos semilla estables.
\end{itemize}

\subsection{F10 — Seguridad y privacidad}
La Fase 10 endurece la seguridad y privacidad de la aplicación mediante la implementación de principios de minimización de datos, control explícito del usuario y operación local por defecto. La aplicación solicita únicamente los permisos estrictamente necesarios (almacenamiento para PDFs, notificaciones opcionales) y los requiere just-in-time cuando el usuario intenta usar la funcionalidad relacionada. El asistente de IA opera completamente en el dispositivo sin enviar datos a servidores externos, y el usuario puede desactivarlo y eliminar el modelo en cualquier momento. Estos controles de privacidad se alinean con las mejores prácticas de desarrollo móvil y las expectativas de usuarios conscientes de la privacidad. Los componentes son:

\begin{itemize}
  \item Objetivo: Datos y permisos mínimos; control explícito del usuario.
  \item Qué se hizo: Sólo nombre y preferencias locales; permisos just-in-time; IA local sin envío de datos.
  \item Entradas$\rightarrow$Salidas: Manifest + AppInit (canales) + Settings (opt-in IA).
  \item DoD: App funciona con permisos mínimos; IA 100\% opt-in/opt-out.
  \item Riesgo: Uso involuntario de IA: mitigado con toggles y borrado del modelo.
\end{itemize}

\subsection{F11 — Release y KPIs}
La Fase 11 prepara la aplicación para su liberación mediante la optimización del empaquetado, la definición de métricas de adopción y uso, y el establecimiento de procesos de despliegue continuo. La optimización incluye la aplicación de ProGuard/R8 para reducir el tamaño del APK, la separación del modelo de IA en un paquete opcional descargable bajo demanda, y la configuración de splits por densidad de pantalla. Las métricas definidas permiten evaluar el éxito de la aplicación: tiempo promedio de consulta de horario (TTS), número de huecos por día en horarios generados, porcentaje de notificaciones entregadas a tiempo, y tasa de adopción del formato JSON para compartir. Los elementos finales son:

\begin{itemize}
  \item Objetivo: Empaque optimizado y medición de adopción/uso.
  \item Qué se hizo: Shrink/optimize; firma y notas; umbrales (APK < 30 MB sin IA; IA ~200–230 MB opcional); KPIs (TTS, gaps/día, on-time, adopción JSON).
  \item Entradas a salidas: Del Build (release) a Artefactos y Métricas base.
  \item DoD: Compilación release estable; tamaños dentro de umbrales; KPIs medibles definidos.
  \item Riesgo: Aumento de tamaño por libs: mitigado con revisión de dependencias y splits.
\end{itemize}


\noindent \textsf{minSdk=24}, \textsf{targetSdk=35}, tamaño del APK: 23\,MB y tamaño del modelo IA: 229\,MB en la build de referencia.

% ----------------------------------------------------------------------
\section{Procedimientos operativos (antes "UC", ahora "PR")}

Los procedimientos operativos documentan los flujos de trabajo principales de la aplicación desde la perspectiva del sistema, describiendo las secuencias de acciones, validaciones y transformaciones que se ejecutan para completar cada operación crítica.

\subsection{PR-001 — Ingestión y normalización}
Actor: Sistema. Objetivo: BD local vigente.
Entry: conectividad o PDF local.
Exit/DoD: last\_sync actualizado, TC-004/005 verdes.

\subsection{PR-002 — Generar horarios}
Actor: Estudiante. Objetivo: obtener $N$ horarios.
Entry: selección de materias/flags.
Exit/DoD: Top-$N$ sin solapes (por defecto), aplicación parcial/completa.

\subsection{PR-003 — Configurar notificaciones}
Actor: Estudiante. Objetivo: avisos antes de clase (10\,min por defecto).

\subsection{PR-004 — Exportar/Importar}
Actor: Estudiante. Objetivo: compartir/clonar; validación de versión y carrera.

% ----------------------------------------------------------------------
\section{Métricas (KPIs) y fórmulas}
\label{sec:kpis}
\noindent TTS (Time-To-Schedule). 
$TTS = t_{\text{aplicado}} - t_{\text{click\_generar}}$ (objetivo $\leq 3$\,min para $N{=}10$).

\noindent Gaps/día.
$\displaystyle \text{Gaps}_{\text{prom}}=\frac{\sum_{d}{\text{minutos vacíos}(d)}}{\#\text{días activos}}$ (objetivo: tendencia a la baja).

\noindent On-time reminders (medible).
$\displaystyle \frac{\#\text{notifs abiertas }\geq X\text{ min antes}}{\#\text{notifs totales}}\times 100\%$ (objetivo $\geq 95\%$).

\noindent Adopción JSON (medible).
\% de export/import exitoso (objetivo $\uparrow$ en semanas pico); replicable por pruebas E2E (F5/F8).

% ----------------------------------------------------------------------
\section{Riesgos y mitigaciones}
El desarrollo de TecnoTime enfrentó diversos riesgos técnicos y operativos que podrían haber comprometido el éxito del proyecto si no se hubieran identificado y mitigado tempranamente. Los riesgos abarcan desde la disponibilidad y formato de los datos fuente (PDFs oficiales) hasta las limitaciones de rendimiento en dispositivos de gama baja y la complejidad del algoritmo de generación de horarios. Para cada riesgo identificado se definió una estrategia de mitigación específica que reduce su probabilidad de ocurrencia o su impacto en caso de materializarse. La tabla siguiente documenta los riesgos principales, su nivel de criticidad y las medidas implementadas para controlarlos:

\begin{table}[H]
  \centering
  \small
  \begin{tabular}{|p{6.6cm}|c|c|p{7.8cm}|}
    \hline
    Riesgo & P & I & Mitigación \\
    \hline
    Cambios en layout/ubicación de PDF & M & A & Parsers tolerantes; revisión manual; import local de PDF \\
    \hline
    Caída prolongada/saturación del sitio & M & A & Backoff + CB; cache local; diferir sync (ventanas); fallback PDF \\
    \hline
    Conectividad intermitente & A & M & Offline-first; política de reintentos; freshness gate antes de generar \\
    \hline
    Dispositivos de baja gama & M & M & UI ligera; optimización de consultas; IA opcional (opt-in) \\
    \hline
    Datos desactualizados & M & M & Freshness check previo a generación; auto-sync condicionado \\
    \hline
  \end{tabular}
  \caption{Riesgos (P=probabilidad, I=impacto) y acciones.}
  \label{tab:riesgos}
  \small{Fuente: Elaboración propia.}
\end{table}

% ----------------------------------------------------------------------
\section{Checklist de release y CI/CD}
El proceso de liberación de TecnoTime requiere la verificación sistemática de múltiples aspectos técnicos y de calidad antes de distribuir la aplicación a usuarios finales. Este checklist garantiza que cada versión liberada cumple con los estándares de funcionalidad, rendimiento, seguridad y experiencia de usuario establecidos en el proyecto. Las verificaciones abarcan desde la ejecución exitosa de la suite de pruebas automatizadas hasta la validación manual de flujos críticos en dispositivos reales, pasando por la revisión de métricas de tamaño de APK y consumo de recursos. El cumplimiento de este checklist reduce significativamente la probabilidad de introducir regresiones o problemas de calidad en producción. Las verificaciones son:

\begin{itemize}
  \item Pruebas verdes; cobertura $\geq 75\%$ en módulos críticos; flujos E2E críticos completos.
  \item Lint/análisis estático sin issues críticos.
  \item Verificar canales de notificación creados y configurados correctamente.
  \item APK $<30$\,MB (sin IA); firma válida; notas de versión; rollout por etapas.
\end{itemize}
