flowchart TD
    A[Inicio Generación] --> B{¿Materias obligatorias > max?}
    B -->|Sí| C[Priorizar obligatorias]
    B -->|No| D[Incluir todas obligatorias]
    
    C --> E{¿Priorizar profesores favoritos?}
    D --> E
    
    E -->|Sí| F[Filtrar grupos con profesores favoritos]
    E -->|No| G[Grupos disponibles]
    
    F --> H{¿Minimizar gaps?}
    G --> H
    
    H -->|Sí| I[Calcular score con penalización gaps]
    H -->|No| J[Calcular score estándar]
    
    I --> K{¿Aceptar conflictos?}
    J --> K
    
    K -->|Sí| L[Permitir overlaps en score]
    K -->|No| M[Rechazar overlaps]
    
    L --> N[Generar opciones]
    M --> N
    
    N --> O{¿Opciones válidas?}
    O -->|Sí| P[Retornar mejores opciones]
    O -->|No| Q[Relajar restricciones opcionales]
    Q --> R[Reintentar generación]